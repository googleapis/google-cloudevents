# Google Events proto schema

The protos within this directory hierarchy represent the data within
events generated by Google eventing infrastructure, usually
represented as the [data
attribute](https://github.com/cloudevents/spec/blob/master/spec.md#event-data)
within a [CloudEvent](https://cloudevents.io/). They are provided as a
machine-readable schema, allowing libraries of data types to be
created to make it easier to consume events.

## Relationship between protobuf messages and CloudEvent types

There are two protobuf messages that are relevant for any given CloudEvent
type:

- The "envelope" message (e.g. `ObjectFinalized`)
- The "data" message (e.g. `StorageObject`)

There is a 1:1 relationship between CloudEvent types and envelope
messages, but a many:1 relationship between CloudEvent types and
data messages. In other words, many CloudEvent types can use the
same data message. For example, every event associated with
something happening to a Cloud Storage object uses `StorageObject`
as the data message. Each envelope message specifies the CloudEvent
type it's associated with via a proto annotation.

Note that each proto package is versioned, but this version is
independent of any API version. It would be possible for a single
API version to support multiple event versions, or vice versa.

Our convention for event types is to have a dot-separated list of
the following values, in the order:

- `google` (always)
- product (e.g. `firebase` or `cloud.storage`)
- resource (e.g. `object` or `document`)
- version (e.g. `v1`)
- action (e.g. `finalized`, `deleted`)

The "action" is the action that causes the event to be emitted.

The proto package (in the `package` part of each .proto file) must
be `google.events.`*product*`.`*version*`. The .proto file should be
in a directory structure where each element of the package name
corresponds to a directory. A file name of `events.proto` is
conventional but not required. As a complete example, consider the
event that is created when a Google Cloud Storage object is
finalized:

- Proto file: `google/events/cloud/storage/v1/events.proto`
- Envelope message: `google.events.cloud.storage.v1.ObjectFinalized`
- Data message: `google.events.cloud.storage.v1.StorageObject`
- Event type: `google.cloud.storage.object.v1.finalized`

Note that the `events` part of the proto package is not part of the
CloudEvent type, for brevity. It's included in the proto package to
distinguish event message from those used in APIs.

Additionally, the version and resource parts deliberately appear in
different orders between fully-qualified message name and CloudEvent
type. That reversal may seem confusing initially, but it means that
events for multiple resources in the same product (e.g. buckets and
objects within Cloud Storage) can use common messages in their
definitions.

## Versioning governance

While not a strict technical necessity, governance rules will
strongly encourage all event types for a single resource to create a
new version at the same time: if there's a need for
`google.cloud.storage.object.v2.finalized`, then all the *other*
object-related event types (`deleted` etc) should be available as
`v2` events as well. However, other resources in the same product do
*not* have to take a new version. This allows users to write common
code to handle all events for a single resource, without creating
unnecessary churn when only an unrelated resource type needs
a new version. (If your code only consumes `bucket.v1` events, the
introduction of `object.v2` events should not affect you.)
